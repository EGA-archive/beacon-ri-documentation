Beacon 2 Production Implementation API
Configuration

Beacon2 PI API has two folders where a user can configure their beacons:

conf: general configuration of the beacon

source: configuration of the beacon model (entry types and databases)

Generic configuration

The beacon needs some configuration in order to show the correct mappings or information.
These variables inside conf.py can be modified.
The uri variable is critical for showing the correct domain, and uri_subpath is appended to it.

Generic configuration example:

beacon_id = 'org.ega-archive.beacon-ri-demo'
beacon_name = 'Beacon Reference Implementation demo'
api_version = 'v2.0.0'
uri = 'http://localhost:5050
'
uri_subpath = '/api'
complete_url = uri + uri_subpath
environment = 'test'
description = "This Beacon is based on synthetic data hosted at the EGA. The dataset contains 2504 samples including genetic data based on 1K Genomes data, and 76 individual attributes and phenotypic data derived from UKBiobank."
version = api_version_yaml['api_version']
welcome_url = 'https://beacon.ega-archive.org/
'
alternative_url = 'https://beacon.ega-archive.org/api
'
create_datetime = '2021-11-29T12:00:00.000000'
update_datetime = ''
default_beacon_granularity = "record"
security_levels = ['PUBLIC', 'REGISTERED', 'CONTROLLED']
documentation_url = 'https://b2ri-documentation-demo.ega-archive.org/
'
cors_urls = ["http://localhost:3003", "http://localhost:3000"]

Service Info

ga4gh_service_type_group = 'org.ga4gh'
ga4gh_service_type_artifact = 'beacon'
ga4gh_service_type_version = '1.0'

Organization info

org_id = 'EGA'
org_name = 'European Genome-Phenome Archive (EGA)'
org_description = 'The European Genome-phenome Archive (EGA) is a service for permanent archiving and sharing of all types of personally identifiable genetic and phenotypic data resulting from biomedical research projects.'
org_adress = 'C/ Dr. Aiguader, 88, PRBB Building 08003 Barcelona, Spain'
org_welcome_url = 'https://ega-archive.org/
'
org_contact_url = 'mailto:beacon.ega@crg.eu
'
org_logo_url = 'https://legacy.ega-archive.org/images/logo.png
'
org_info = ''

Budget configuration

You can limit how many queries a user or IP can perform by editing the Query budget variables in conf.py.

Query budget example:

query_budget_per_user = False
query_budget_per_ip = False
query_budget_amount = 3
query_budget_time_in_seconds = 20
query_budget_database = 'mongo'
query_budget_db_name = 'beacon'
query_budget_table = 'budget'

Explanation:

query_budget_per_user and query_budget_per_ip are booleans

query_budget_amount defines the number of allowed queries

query_budget_time_in_seconds defines the time window

If a user is unauthenticated, per-user budgets require per-IP budgets to be enabled as well.

Query rounding

Query rounding is configured in conf.py.

Example:

imprecise_count = 0
round_to_tens = False
round_to_hundreds = False

Explanation:

imprecise_count overrides all others

round_to_tens rounds to the next ten

round_to_hundreds rounds to the next hundred

Entry types configuration

Each entry type (for example analysis) has its own configuration file.

Example entry type configuration:

endpoint_name = "analyses"
open_api_endpoints_definition = "https://raw.githubusercontent.com/ga4gh-beacon/beacon-v2/main/models/json/beacon-v2-default-model/analyses/endpoints.json
"
database = "mongo"

granularity = "record"

id = "analysis"
name = "Bioinformatics analysis"
ontology_id = "edam:operation_2945"
ontology_name = "Analysis"
specification = "Beacon v2.0.0"
description = "Apply analytical methods to existing data of a specific type."
defaultSchema_id = "beacon-analysis-v2.0.0"
defaultSchema_name = "Default schema for a bioinformatics analysis"
defaultSchema_reference_to_schema_definition = "https://raw.githubusercontent.com/ga4gh-beacon/beacon-v2/main/models/json/beacon-v2-default-model/analyses/defaultSchema.json
"
defaultSchema_schema_version = "v2.0.0"
aditionally_supported_schemas = []
allow_queries_without_filters = True

Map configuration:

singleEntryUrl = True
biosample_lookup = True
cohort_lookup = True
dataset_lookup = True
genomicVariant_lookup = True
individual_lookup = True
run_lookup = True

Managing dataset permissions

There are three security levels:

public

registered

controlled

Public datasets are accessible without authentication.
Registered datasets require a valid token.
Controlled datasets require authentication and authorization.

Example permissions file:

CINECA_synthetic_cohort_EUROPE_UK1:
public:
default_entry_types_granularity: record
entry_types_exceptions:
- cohort: boolean

random_dataset:
registered:
default_entry_types_granularity: count
entry_types_exceptions:
- individual: boolean

Controlled dataset example:

AV_Dataset:
controlled:
default_entry_types_granularity: record
entry_types_exceptions:
- individual: boolean
user-list:
- user_e-mail: jane.smith@beacon.ga4gh

default_entry_types_granularity: count
entry_types_exceptions:
- individual: record

Supplying AAI credentials

Create a .env file for each Identity Provider.

Example:

CLIENT_ID=beacon
CLIENT_SECRET=your_secret
USER_INFO=http://idp:8080/auth/realms/Beacon/protocol/openid-connect/userinfo

INTROSPECTION=http://idp:8080/auth/realms/Beacon/protocol/openid-connect/token/introspect

ISSUER=http://localhost:8080/auth/realms/Beacon

JWKS_URL=http://idp:8080/auth/realms/Beacon/protocol/openid-connect/certs

Rebuild the beacon container afterward.

Handling CORS

Add allowed URLs to cors_urls in beacon/conf/conf.py.

Example:

cors_urls = [
"http://localhost:3000",
"https://cancer-beacon-demo.ega-archive.org
",
"https://beacon-network-demo2.ega-archive.org
",
"https://beacon.ega-archive.org
"
]

Setting the default granularity

max_beacon_granularity = "record"

Adding beacon handovers

Handovers can be added globally or per dataset.

Handover definition:

handover_1 = {
"note": "Description of the handover",
"url": "Link for the handover",
"handoverType": {
"id": "NCIT:C189151",
"label": "Study Data Repository"
}
}

General response handover:

list_of_handovers = [handover_1]

Handover per dataset:

dataset1_handover = {
"dataset": dataset1_id,
"handover": handover_1
}

list_of_handovers_per_dataset = [dataset1_handover]

Configuring your entry types (YAML)

analysis:
entry_type_enabled: True
max_granularity: record
endpoint_name: analyses
open_api_definition: https://raw.githubusercontent.com/ga4gh-beacon/beacon-v2/main/models/json/beacon-v2-default-model/analyses/endpoints.json

allow_queries_without_filters: True
allow_id_query: True
response_type: non_collection
connection:
name: mongo
database: beacon
table: analyses
functions:
function_name_assigned: get_phenotypic_endpoint
id_query_function_name_assigned: get_phenotypic_endpoint_with_id
info:
name: Bioinformatics analysis
ontology_id: edam:operation_2945
ontology_name: Analysis
description: Apply analytical methods to existing data of a specific type.
schema:
specification: Beacon v2
default_schema_id: beacon-analysis-v2.0.0
default_schema_name: Default schema for a bioinformatics analysis
reference_to_default_schema_definition: https://raw.githubusercontent.com/ga4gh-beacon/beacon-v2/main/models/json/beacon-v2-default-model/analyses/defaultSchema.json

default_schema_version: v2.0.0
supported_schemas:
- beacon-analysis-v2.0.0
- beacon-analysis-v2.0.1
- beacon-analysis-v2.1.0
- beacon-analysis-v2.1.1
- beacon-analysis-v2.1.2
- beacon-analysis-v2.2.0

Setting the logs

Log level:

level = logging.NOTSET

Log file:

log_file = None

Note:
To save logs outside Docker, use the default volume:
./beacon/logs/logs.log:/beacon/logs/logs.log

Test Mode

Example dataset configuration:

CINECA_synthetic_cohort_EUROPE_UK1:
isTest: false

test:
isSynthetic: true
isTest: true